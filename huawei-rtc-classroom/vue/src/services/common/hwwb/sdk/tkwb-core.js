!function(t){var e={};function i(n){if(e[n])return e[n].exports;var s=e[n]={i:n,l:!1,exports:{}};return t[n].call(s.exports,s,s.exports,i),s.l=!0,s.exports}i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)i.d(n,s,function(e){return t[e]}.bind(null,s));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=1)}([function(t,e){!function(){var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};function e(e){return String(e).replace(/[&<>"'`=/]/g,function(e){return t[e]})}if(!document.defaultView.getComputedStyle)throw"ERROR: 'document.defaultView.getComputedStyle' not found. This library only works in browsers that can report computed CSS values.";CanvasRenderingContext2D.prototype.measureTextWidth=CanvasRenderingContext2D.prototype.measureText;CanvasRenderingContext2D.prototype.measureText2=function(t,i,n){var s=this.measureTextWidth(t),r=!/\S/.test(t);s.fontsize=i;var o=document.createElement("div");o.style.position="absolute",o.style.opacity=0,o.style.font=n,o.innerHTML=e(t)+"<br/>"+e(t),document.body.appendChild(o),s.leading=1.2*i;var a=function(t,e){return document.defaultView.getComputedStyle(t,null).getPropertyValue(e)}(o,"height");if((a=a.replace("px",""))>=2*i&&(s.leading=a/2|0),document.body.removeChild(o),r)s.ascent=0,s.descent=0,s.bounds={minx:0,maxx:s.width,miny:0,maxy:0},s.height=0;else{var h=document.createElement("canvas");h.width=s.width+100,h.height=3*i,h.style.opacity=1,h.style.font=n;var l=h.getContext("2d");l.font=n;var c=h.width,d=h.height,u=d/2;l.fillStyle="white",l.fillRect(-1,-1,c+2,d+2),l.fillStyle="black",l.fillText(t,50,u);for(var p=l.getImageData(0,0,c,d).data,g=0,m=4*c,f=p.length;++g<f&&255===p[g];);var y=g/m|0;for(g=f-1;--g>0&&255===p[g];);var S=g/m|0;for(g=0;g<f&&255===p[g];)(g+=m)>=f&&(g=g-f+4);var x=g%m/4|0,w=1;for(g=f-3;g>=0&&255===p[g];)(g-=m)<0&&(g=f-3-4*w++);var v=g%m/4+1|0;s.ascent=u-y,s.descent=S-u,s.bounds={minx:x-50,maxx:v-50,miny:0,maxy:S-y},s.height=S-y+1}return s}}()},function(t,e,i){"use strict";i.r(e);var n={};i.r(n),i.d(n,"defineCanvasRenderer",function(){return g}),i.d(n,"renderShapeToCanvas",function(){return y}),i.d(n,"renderShapeToContext",function(){return f});var s={};i.r(s),i.d(s,"defineSVGRenderer",function(){return b}),i.d(s,"renderShapeToSVG",function(){return k});var r={};i.r(r),i.d(r,"addImageOnload",function(){return C}),i.d(r,"last",function(){return P}),i.d(r,"classSet",function(){return z}),i.d(r,"matchElementSize",function(){return E}),i.d(r,"combineCanvases",function(){return R}),i.d(r,"renderShapes",function(){return I}),i.d(r,"renderShapesToSVG",function(){return L}),i.d(r,"getBoundingRect",function(){return _}),i.d(r,"getDefaultImageRect",function(){return W}),i.d(r,"getBackingScale",function(){return M}),i.d(r,"getGUID",function(){return T}),i.d(r,"requestAnimationFrame",function(){return B}),i.d(r,"cancelAnimationFrame",function(){return O});var o={};i.r(o),i.d(o,"defineShape",function(){return F}),i.d(o,"createShape",function(){return U}),i.d(o,"JSONToShape",function(){return $}),i.d(o,"shapeToJSON",function(){return V});var a={};i.r(a),i.d(a,"ClearAction",function(){return pt}),i.d(a,"MoveAction",function(){return gt}),i.d(a,"AddShapeAction",function(){return mt});var h={};i.r(h),i.d(h,"localize",function(){return zt}),i.d(h,"_",function(){return Et});class l{constructor(){}begin(t,e,i){}continue(t,e,i){}end(t,e,i){}didBecomeActive(t){}willBecomeInactive(t){}}l.prototype.name=null,l.prototype.iconName=null,l.prototype.usesSimpleAPI=!0,l.prototype.optionsStyle=null;class c extends l{constructor(t){super(),this.strokeWidth=t.opts.defaultStrokeWidth}didBecomeActive(t){const e=[];this.unsubscribe=(()=>{e.map(t=>t())}),e.push(t.on("setStrokeWidth",e=>{this.strokeWidth=e,t.trigger("toolDidUpdateOptions")}))}willBecomeInactive(t){this.unsubscribe()}}c.prototype.optionsStyle="stroke-width";const d=(t,e,i,n,s)=>[{x:t+Math.cos(i+Math.PI/2)*n/2,y:e+Math.sin(i+Math.PI/2)*n/2},{x:t+Math.cos(i)*s,y:e+Math.sin(i)*s},{x:t+Math.cos(i-Math.PI/2)*n/2,y:e+Math.sin(i-Math.PI/2)*n/2}];var u={arrow:{drawToCanvas(t,e,i,n,s,r,o){null==o&&(o=0),o=o||s,t.fillStyle=r,t.lineWidth=0,t.strokeStyle="transparent",t.beginPath();const a=d(e,i,n,s,o);t.moveTo(a[0].x,a[0].y),t.lineTo(a[1].x,a[1].y),t.lineTo(a[2].x,a[2].y),t.fill()},svg(t,e,i,n,s,r){null==r&&(r=0);d(t,e,i,n,r=r||n)}}};const p={},g=(t,e,i)=>p[t]={drawFunc:e,drawLatestFunc:i},m=function(){},f=function(t,e,i){null==i&&(i={}),null==i.shouldIgnoreUnsupportedShapes&&(i.shouldIgnoreUnsupportedShapes=!1),null==i.retryCallback&&(i.retryCallback=m),null==i.shouldOnlyDrawLatest&&(i.shouldOnlyDrawLatest=!1),null==i.bufferCtx&&(i.bufferCtx=null);const{bufferCtx:n}=i;if(p[e.className])i.shouldOnlyDrawLatest&&p[e.className].drawLatestFunc?p[e.className].drawLatestFunc(t,n,e,i.retryCallback):p[e.className].drawFunc(t,e,i.retryCallback);else{if(!i.shouldIgnoreUnsupportedShapes)throw`Can't render shape of type ${e.className} to canvas`;console.warn(`Can't render shape of type ${e.className} to canvas`)}},y=(t,e,i)=>f(t.getContext("2d"),e,i);g("Rectangle",function(t,e){let{x:i}=e,{y:n}=e;e.strokeWidth%2!=0&&(i+=.5,n+=.5),t.fillStyle=e.fillColor,t.fillRect(i,n,e.width,e.height),t.lineWidth=e.strokeWidth,t.strokeStyle=e.strokeColor,t.strokeRect(i,n,e.width,e.height)}),g("Ellipse",function(t,e){t.save();const i=Math.floor(e.width/2),n=Math.floor(e.height/2),s=e.x+i,r=e.y+n;t.translate(s,r),t.scale(1,Math.abs(e.height/e.width)),t.beginPath(),t.arc(0,0,Math.abs(i),0,2*Math.PI),t.closePath(),t.restore(),t.fillStyle=e.fillColor,t.fill(),t.lineWidth=e.strokeWidth,t.strokeStyle=e.strokeColor,t.stroke()}),g("SelectionBox",function(){const t=function(t,{x:e,y:i},n){0!==n&&(t.fillStyle="#fff",t.fillRect(e,i,n,n),t.strokeStyle="#000",t.strokeRect(e,i,n,n))};return function(e,i){t(e,i.getTopLeftHandleRect(),i.handleSize),t(e,i.getTopRightHandleRect(),i.handleSize),t(e,i.getBottomLeftHandleRect(),i.handleSize),t(e,i.getBottomRightHandleRect(),i.handleSize),i.backgroundColor&&(e.fillStyle=i.backgroundColor,e.fillRect(i._br.x-i.margin,i._br.y-i.margin,i._br.width+2*i.margin,i._br.height+2*i.margin)),e.lineWidth=1,e.strokeStyle=i.backgroundColor||"#000",e.setLineDash([2,4]),e.strokeRect(i._br.x-i.margin,i._br.y-i.margin,i._br.width+2*i.margin,i._br.height+2*i.margin),e.setLineDash([])}}()),g("Image",function(t,e,i){if(e.image.width){if(1!==e.scale)return t.drawImage(e.image,e.x,e.y,e.image.width*e.scale,e.image.height*e.scale);t.drawImage(e.image,e.x,e.y)}else i&&(e.image.onload=i)}),g("Line",function(t,e){if(e.x1===e.x2&&e.y1===e.y2)return;let{x1:i}=e,{x2:n}=e,{y1:s}=e,{y2:r}=e;e.strokeWidth%2!=0&&(i+=.5,n+=.5,s+=.5,r+=.5),t.lineWidth=e.strokeWidth,t.strokeStyle=e.color,t.lineCap=e.capStyle,e.dash&&t.setLineDash(e.dash),t.beginPath(),t.moveTo(i,s),t.lineTo(n,r),t.stroke(),e.dash&&t.setLineDash([]);const o=Math.max(2.2*e.strokeWidth,5);e.endCapShapes[0]&&u[e.endCapShapes[0]].drawToCanvas(t,i,s,Math.atan2(s-r,i-n),o,e.color),e.endCapShapes[1]&&u[e.endCapShapes[1]].drawToCanvas(t,n,r,Math.atan2(r-s,n-i),o,e.color)});const S=function(t,e,i,n){if(null==i&&(i=!1),null==n&&(n="round"),e.length){t.lineCap=n,t.strokeStyle=e[0].color,t.lineWidth=e[0].size,t.beginPath(),e[0].size%2==0?t.moveTo(e[0].x,e[0].y):t.moveTo(e[0].x+.5,e[0].y+.5);for(let i of e.slice(1))e[0].size%2==0?t.lineTo(i.x,i.y):t.lineTo(i.x+.5,i.y+.5);i&&t.closePath()}},x=function(t,e){S(t,e.smoothedPoints),t.stroke()},w=function(t,e,i){if(i.tail){const t=i.smoothedPoints.length-i.segmentSize*i.tailSize,n=t<2*i.segmentSize?0:t,s=t+i.segmentSize+1;S(e,i.smoothedPoints.slice(n,s)),e.stroke()}else S(e,i.smoothedPoints),e.stroke()};g("LinePath",x,w);g("ErasedLinePath",function(t,e){t.save(),t.globalCompositeOperation="destination-out",x(t,e),t.restore()},function(t,e,i){t.save(),t.globalCompositeOperation="destination-out",e.save(),e.globalCompositeOperation="destination-out",w(0,e,i),t.restore(),e.restore()}),g("Text",function(t,e){e.renderer||e._makeRenderer(t),t.fillStyle=e.color,e.renderer.draw(t,e.x,e.y)}),g("Polygon",function(t,e){t.fillStyle=e.fillColor,S(t,e.points,e.isClosed,"butt"),t.fill(),t.stroke()});const v={},b=(t,e)=>v[t]=e,k=function(t,e){if(null==e&&(e={}),null==e.shouldIgnoreUnsupportedShapes&&(e.shouldIgnoreUnsupportedShapes=!1),v[t.className])return v[t.className](t);if(e.shouldIgnoreUnsupportedShapes)return console.warn(`Can't render shape of type ${t.className} to SVG`),"";throw`Can't render shape of type ${t.className} to SVG`};function C(t,e){const i=t.onload;return t.onload=function(){"function"==typeof i&&i(),e()},t}function P(t,e=null){return e?Array.prototype.slice.call(t,Math.max(t.length-e,0)):t[t.length-1]}function z(t){const e=[];for(let i in t)t[i]&&e.push(i);return e.join(" ")}function E(t,e,i,n){null==n&&(n=function(){});const s=()=>{for(let n of e)n.style.width=`${t.offsetWidth}px`,n.style.height=`${t.offsetHeight}px`,null!=n.width&&(n.setAttribute("width",n.offsetWidth*i),n.setAttribute("height",n.offsetHeight*i));n()};return t.addEventListener("resize",s),window.addEventListener("resize",s),window.addEventListener("orientationchange",s),s(),s}function R(...t){const e=document.createElement("canvas");for(var i of(e.width=t[0].width,e.height=t[0].height,t))e.width=Math.max(i.width,e.width),e.height=Math.max(i.height,e.height);const n=e.getContext("2d");for(i of t)n.drawImage(i,0,0);return e}function I(t,e,i,n=null){null==i&&(i=1),(n=n||document.createElement("canvas")).width=e.width*i,n.height=e.height*i;const s=n.getContext("2d");s.translate(-e.x*i,-e.y*i),s.scale(i,i);for(let e of t)f(s,e);return n}function L(t,{x:e,y:i,width:n,height:s},r){}function _(t,e,i){if(!t.length)return{x:0,y:0,width:e,height:i};let n=t[0].x,s=t[0].y,r=t[0].x+t[0].width,o=t[0].y+t[0].height;for(let e of t)n=Math.floor(Math.min(e.x,n)),s=Math.floor(Math.min(e.y,s)),r=Math.ceil(Math.max(r,e.x+e.width)),o=Math.ceil(Math.max(o,e.y+e.height));return{x:n=e?0:n,y:s=i?0:s,width:(r=e||r)-n,height:(o=i||o)-s}}function W(t,e,i){null==e&&(e={width:0,height:0}),null==i&&(i={top:0,right:0,bottom:0,left:0});const{width:n,height:s}=e,r=_(t,"infinite"===n?0:n,"infinite"===s?0:s);return r.x-=i.left,r.y-=i.top,r.width+=i.left+i.right,r.height+=i.top+i.bottom,r}function M(t){return null==window.devicePixelRatio?1:window.devicePixelRatio>1?window.devicePixelRatio:1}function T(){const t=()=>Math.floor(65536*(1+Math.random())).toString(16).substring(1);return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()}function B(t){return window.requestAnimationFrame?window.requestAnimationFrame(t):window.webkitRequestAnimationFrame?window.webkitRequestAnimationFrame(t):window.mozRequestAnimationFrame?window.mozRequestAnimationFrame(t):setTimeout(t,0)}function O(t){window.cancelAnimationFrame&&window.cancelAnimationFrame(t),window.webkitCancelRequestAnimationFrame&&window.webkitCancelRequestAnimationFrame(t),window.webkitCancelAnimationFrame&&window.webkitCancelAnimationFrame(t),window.mozCancelAnimationFrame&&window.mozCancelAnimationFrame(t),clearTimeout(t)}b("Rectangle",function(t){const e=t.x,i=t.y,n=t.x+t.width,s=t.y+t.height;let r=Math.min(e,n),o=Math.min(i,s);Math.max(e,n),Math.max(i,s);t.strokeWidth%2!=0&&(r+=.5,o+=.5)}),b("SelectionBox",()=>{}),b("Ellipse",function(t){const e=Math.floor(t.width/2),i=Math.floor(t.height/2);t.x,t.y}),b("Image",t=>`<image x='${t.x}' y='${t.y}' width='${t.image.naturalWidth*t.scale}' height='${t.image.naturalHeight*t.scale}' xlink:href='${t.image.src}' />`),b("Line",function(t){t.dash&&t.dash.join(", ");let e="";const i=Math.max(2.2*t.strokeWidth,5);let{x1:n}=t,{x2:s}=t,{y1:r}=t,{y2:o}=t;t.strokeWidth%2!=0&&(n+=.5,s+=.5,r+=.5,o+=.5),t.endCapShapes[0]&&(e+=u[t.endCapShapes[0]].svg(n,r,Math.atan2(r-o,n-s),i,t.color)),t.endCapShapes[1]&&(e+=u[t.endCapShapes[1]].svg(s,o,Math.atan2(o-r,s-n),i,t.color))}),b("LinePath",t=>`<polyline fill='none' points='${t.smoothedPoints.map(function(t){const e=t.strokeWidth%2==0?0:.5;return`${t.x+e},${t.y+e}`}).join(" ")}' stroke='${t.points[0].color}' stroke-linecap='round' stroke-width='${t.points[0].size}' />`),b("ErasedLinePath",()=>{}),b("Polygon",function(t){t.isClosed}),b("Text",function(t){t.forcedWidth&&t.forcedWidth,t.forcedHeight&&t.forcedHeight;let e=t.text.split(/\r\n|\r|\n/g);t.renderer&&(e=t.renderer.lines)});i(0);const D=function(t){const e=t.split(" ");let i=0;for(let t of e){const e=parseInt(t.replace("px",""),10);isNaN(e)||(i=e)}if(!i)throw"Font size not found";return{fontSize:i,fontFamily:t.substring(e[0].length+1).replace("bold ","").replace("italic ","").replace("underline ","")}},N=function(t,e,i){if(!e.length)return["",""];let n=0,s=0,r=0,o=!1;for(;;){const a=(n+=1)>=e.length,h=!a&&e[n].match(/\s/),l=h||a,c=e.substring(0,n),d=!i||t.measureTextWidth(c).width<=i;if(d&&(r=n),l&&o&&(o=!1,d&&(s=n)),o=!h,a||!d){if(d)return[e,""];if(s>0){let t=s+1;for(;t<e.length&&e[t].match(/\s/);)t+=1;return[e.substring(0,s),e.substring(t)]}return[e.substring(0,r),e.substring(r)]}}},A=function(t,e,i){const n=e.split(/\r\n|\r|\n/g),s=[];for(let e of n){let[n,r]=N(t,e,i);if(n)for(;n;)s.push(n),[n,r]=N(t,r,i);else s.push(e)}return s};var H=class{constructor(t,e,i,n,s){this.text=e,this.font=i,this.forcedWidth=n,this.forcedHeight=s;const{fontFamily:r,fontSize:o}=D(this.font);t.font=this.font,t.textBaseline="baseline",this.emDashWidth=t.measureTextWidth("â€”",o,r).width,this.caratWidth=t.measureTextWidth("|",o,r).width,this.lines=A(t,this.text,this.forcedWidth),this.metricses=this.lines.map(e=>t.measureText2(e||"X",o,this.font)),this.metrics={ascent:Math.max(...this.metricses.map(({ascent:t})=>t)),descent:Math.max(...this.metricses.map(({descent:t})=>t)),fontsize:Math.max(...this.metricses.map(({fontsize:t})=>t)),leading:Math.max(...this.metricses.map(({leading:t})=>t)),width:Math.max(...this.metricses.map(({width:t})=>t)),height:Math.max(...this.metricses.map(({height:t})=>t)),bounds:{minx:Math.min(...this.metricses.map(({bounds:t})=>t.minx)),miny:Math.min(...this.metricses.map(({bounds:t})=>t.miny)),maxx:Math.max(...this.metricses.map(({bounds:t})=>t.maxx)),maxy:Math.max(...this.metricses.map(({bounds:t})=>t.maxy))}},this.boundingBoxWidth=Math.ceil(this.metrics.width)}draw(t,e,i){t.textBaseline="top",t.font=this.font;let n=0;for(let s of this.lines)t.fillText(s,e,i+n++*this.metrics.leading)}getWidth(t){return null==t&&(t=!1),this.forcedWidth?this.forcedWidth:t?this.metrics.bounds.maxx+this.caratWidth:this.metrics.bounds.maxx}getHeight(){return this.forcedHeight||this.metrics.leading*this.lines.length}};const J={},F=function(t,e){const i=function(t,i,n,s,r,o,a,h,l,c,d,u,p,g,m,f){return e.constructor.call(this,t,i,n,s,r,o,a,h,l,c,d,u,p,g,m,f),this};if(i.prototype.className=t,i.fromJSON=e.fromJSON,e.draw){const i=e.draw,n=e.draw||function(t,e,i){this.draw(t,e,i)},s=(t,e,n)=>i.call(e,t,n),r=(t,e,i,s)=>n.call(i,t,e,s);delete e.draw,e.drawLatest&&delete e.drawLatest,g(t,s,r)}if(e.toSVG){const i=e.toSVG,n=t=>i.call(t);delete e.toSVG,b(t,n)}i.prototype.draw=function(t,e){f(t,this,{retryCallback:e})},i.prototype.drawLatest=function(t,e,i){f(t,this,{retryCallback:i,bufferCtx:e,shouldOnlyDrawLatest:!0})},i.prototype.toSVG=function(){k(this)};for(let t in e)"fromJSON"!==t&&(i.prototype[t]=e[t]);return J[t]=i,i},U=function(t,e,i,n,s,r,o,a,h,l,c,d,u,p,g,m,f){const y=new J[t](e,i,n,s,r,o,a,h,l,c,d,u,p,g,m,f);return y.id=T(),y},$=function({className:t,data:e,id:i}){if(t in J){const n=J[t].fromJSON(e);return n?(i&&(n.id=i),n):(console.log("Unreadable shape:",t,e),null)}return console.log("Unknown shape:",t,e),null},V=t=>({className:t.className,data:t.toJSON(),id:t.id});var j=function(t,e){return e?j(q(q(G(t))),e-1):t},G=function(t){t=[t[0]].concat(t).concat(P(t));const e=[];let i=0;for(let n of t)e[2*i]=n,t[i+1]&&(e[2*i+1]=X(n,t[i+1])),i+=1;return e},q=function(t){const e=[];let i=0;for(let n of t)t[i+1]&&(e[i]=X(n,t[i+1])),i+=1;return e},X=(t,e)=>U("Point",{x:t.x+(e.x-t.x)/2,y:t.y+(e.y-t.y)/2,size:t.size+(e.size-t.size)/2,color:t.color});F("Image",{constructor(t){null==t&&(t={}),this.x=t.x||0,this.y=t.y||0,this.scale=t.scale||1,this.image=t.image||null,this.crossOrigin=t.image&&t.image.crossOrigin||null},getBoundingRect(){return{x:this.x,y:this.y,width:this.image.width*this.scale,height:this.image.height*this.scale}},toJSON(){const t={x:this.x,y:this.y,imageSrc:this.image.src,imageObject:this.image,scale:this.scale};return this.crossOrigin&&(t.crossOrigin=this.crossOrigin),t},fromJSON(t){let e=null;return(null!=t.imageObject?t.imageObject.width:void 0)?e=t.imageObject:((e=new Image).src=t.imageSrc,t.crossOrigin&&(e.crossOrigin=t.crossOrigin)),U("Image",{x:t.x,y:t.y,image:e,scale:t.scale})},move(t){null==t&&(t={}),this.x=this.x-t.xDiff,this.y=this.y-t.yDiff},setUpperLeft(t){null==t&&(t={}),this.x=t.x,this.y=t.y}}),F("Rectangle",{constructor(t){null==t&&(t={}),this.x=t.x||0,this.y=t.y||0,this.width=t.width||0,this.height=t.height||0,this.strokeWidth=t.strokeWidth||1,this.strokeColor=t.strokeColor||"black",this.fillColor=t.fillColor||"transparent"},getBoundingRect(){return{x:this.x-this.strokeWidth/2,y:this.y-this.strokeWidth/2,width:this.width+this.strokeWidth,height:this.height+this.strokeWidth}},toJSON(){return{x:this.x,y:this.y,width:this.width,height:this.height,strokeWidth:this.strokeWidth,strokeColor:this.strokeColor,fillColor:this.fillColor}},fromJSON:t=>U("Rectangle",t),move(t){null==t&&(t={}),this.x=this.x-t.xDiff,this.y=this.y-t.yDiff},setUpperLeft(t){null==t&&(t={}),this.x=t.x,this.y=t.y}}),F("Ellipse",{constructor(t){null==t&&(t={}),this.x=t.x||0,this.y=t.y||0,this.width=t.width||0,this.height=t.height||0,this.strokeWidth=t.strokeWidth||1,this.strokeColor=t.strokeColor||"black",this.fillColor=t.fillColor||"transparent"},getBoundingRect(){return{x:this.x-this.strokeWidth/2,y:this.y-this.strokeWidth/2,width:this.width+this.strokeWidth,height:this.height+this.strokeWidth}},toJSON(){return{x:this.x,y:this.y,width:this.width,height:this.height,strokeWidth:this.strokeWidth,strokeColor:this.strokeColor,fillColor:this.fillColor}},fromJSON:t=>U("Ellipse",t),move(t){null==t&&(t={}),this.x=this.x-t.xDiff,this.y=this.y-t.yDiff},setUpperLeft(t){null==t&&(t={}),this.x=t.x,this.y=t.y}}),F("Line",{constructor(t){null==t&&(t={}),this.x1=t.x1||0,this.y1=t.y1||0,this.x2=t.x2||0,this.y2=t.y2||0,this.strokeWidth=t.strokeWidth||1,this.color=t.color||"black",this.capStyle=t.capStyle||"round",this.endCapShapes=t.endCapShapes||[null,null],this.dash=t.dash||null},getBoundingRect(){return{x:Math.min(this.x1,this.x2)-this.strokeWidth/2,y:Math.min(this.y1,this.y2)-this.strokeWidth/2,width:Math.abs(this.x2-this.x1)+this.strokeWidth/2,height:Math.abs(this.y2-this.y1)+this.strokeWidth/2}},toJSON(){return{x1:this.x1,y1:this.y1,x2:this.x2,y2:this.y2,strokeWidth:this.strokeWidth,color:this.color,capStyle:this.capStyle,dash:this.dash,endCapShapes:this.endCapShapes}},fromJSON:t=>U("Line",t),move(t){null==t&&(t={}),this.x1=this.x1-t.xDiff,this.y1=this.y1-t.yDiff,this.x2=this.x2-t.xDiff,this.y2=this.y2-t.yDiff},setUpperLeft(t){null==t&&(t={});const e=this.getBoundingRect(),i=e.x-t.x,n=e.y-t.y;this.move({xDiff:i,yDiff:n})}});const Y=function(t,e){let i=null;e.points?i=e.points.map(t=>$(t)):e.pointCoordinatePairs&&(i=e.pointCoordinatePairs.map(([t,i])=>$({className:"Point",data:{x:t,y:i,size:e.pointSize,color:e.pointColor,smooth:e.smooth}})));let n=null;return e.smoothedPointCoordinatePairs&&(n=e.smoothedPointCoordinatePairs.map(([t,i])=>$({className:"Point",data:{x:t,y:i,size:e.pointSize,color:e.pointColor,smooth:e.smooth}}))),i[0]?U(t,{points:i,smoothedPoints:n,order:e.order,tailSize:e.tailSize,smooth:e.smooth}):null},K={constructor(t){null==t&&(t={});const e=t.points||[];this.order=t.order||3,this.tailSize=t.tailSize||3,this.smooth=!("smooth"in t)||t.smooth,this.segmentSize=Math.pow(2,this.order),this.sampleSize=this.tailSize+1,t.smoothedPoints?(this.points=t.points,this.smoothedPoints=t.smoothedPoints):(this.points=[],e.map(t=>this.addPoint(t)))},getBoundingRect(){return _(this.points.map(t=>({x:t.x-t.size/2,y:t.y-t.size/2,width:t.size,height:t.size})))},toJSON(){return function(t){if(!t.length)return!1;const{size:e}=t[0],{color:i}=t[0];for(let n of t)if(n.size===e&&n.color===i||console.log(e,i,n.size,n.color),n.size!==e||n.color!==i)return!1;return!0}(this.points)?{order:this.order,tailSize:this.tailSize,smooth:this.smooth,pointCoordinatePairs:this.points.map(t=>[t.x,t.y]),smoothedPointCoordinatePairs:this.smoothedPoints.map(t=>[t.x,t.y]),pointSize:this.points[0].size,pointColor:this.points[0].color}:{order:this.order,tailSize:this.tailSize,smooth:this.smooth,points:this.points.map(t=>V(t))}},fromJSON:t=>Y("LinePath",t),addPoint(t){this.points.push(t),this.smooth?!this.smoothedPoints||this.points.length<this.sampleSize?this.smoothedPoints=j(this.points,this.order):(this.tail=P(j(P(this.points,this.sampleSize),this.order),this.segmentSize*this.tailSize),this.smoothedPoints=this.smoothedPoints.slice(0,this.smoothedPoints.length-this.segmentSize*(this.tailSize-1)).concat(this.tail)):this.smoothedPoints=this.points},move(t){let e;null==t&&(t={}),e=this.smooth?this.smoothedPoints:this.points;for(let i of e)i.move(t);this.points=this.smoothedPoints},setUpperLeft(t){null==t&&(t={});const e=this.getBoundingRect(),i=e.x-t.x,n=e.y-t.y;this.move({xDiff:i,yDiff:n})}};F("LinePath",K);F("ErasedLinePath",{constructor:K.constructor,toJSON:K.toJSON,addPoint:K.addPoint,getBoundingRect:K.getBoundingRect,fromJSON:t=>Y("ErasedLinePath",t)}),F("Point",{constructor(t){null==t&&(t={}),this.x=t.x||0,this.y=t.y||0,this.size=t.size||0,this.color=t.color||""},getBoundingRect(){return{x:this.x-this.size/2,y:this.y-this.size/2,width:this.size,height:this.size}},toJSON(){return{x:this.x,y:this.y,size:this.size,color:this.color}},fromJSON:t=>U("Point",t),move(t){null==t&&(t={}),this.x=this.x-t.xDiff,this.y=this.y-t.yDiff},setUpperLeft(t){null==t&&(t={}),this.x=t.x,this.y=t.y}}),F("Polygon",{constructor(t){null==t&&(t={}),this.points=t.points,this.fillColor=t.fillColor||"white",this.strokeColor=t.strokeColor||"black",this.strokeWidth=t.strokeWidth,this.dash=t.dash||null,null==t.isClosed&&(t.isClosed=!0),this.isClosed=t.isClosed,this.points.forEach(t=>{t.color=this.strokeColor,t.size=this.strokeWidth})},addPoint(t,e){this.points.push(U("Point",{x:t,y:e}))},getBoundingRect(){return _(this.points.map(t=>t.getBoundingRect()))},toJSON(){return{strokeWidth:this.strokeWidth,fillColor:this.fillColor,strokeColor:this.strokeColor,dash:this.dash,isClosed:this.isClosed,pointCoordinatePairs:this.points.map(t=>[t.x,t.y])}},fromJSON:t=>(t.points=t.pointCoordinatePairs.map(function(...e){const[i,n]=e[0];return U("Point",{x:i,y:n,size:t.strokeWidth,color:t.strokeColor})}),U("Polygon",t)),move(t){null==t&&(t={}),this.points.map(e=>e.move(t))},setUpperLeft(t){null==t&&(t={});const e=this.getBoundingRect(),i=e.x-t.x,n=e.y-t.y;this.move({xDiff:i,yDiff:n})}}),F("Text",{constructor(t){null==t&&(t={}),this.x=t.x||0,this.y=t.y||0,this.v=t.v||0,this.text=t.text||"",this.color=t.color||"black",this.font=t.font||"18px sans-serif",this.forcedWidth=t.forcedWidth||null,this.forcedHeight=t.forcedHeight||null},_makeRenderer(t){t.lineHeight=1.2,this.renderer=new H(t,this.text,this.font,this.forcedWidth,this.forcedHeight),this.v<1&&(console.log("repairing baseline"),this.v=1,this.x-=this.renderer.metrics.bounds.minx,this.y-=this.renderer.metrics.leading-this.renderer.metrics.descent)},setText(t){this.text=t,this.renderer=null},setFont(t){this.font=t,this.renderer=null},setPosition(t,e){this.x=t,this.y=e},setSize(t,e){this.forcedWidth=Math.max(t,0),this.forcedHeight=Math.max(e,0),this.renderer=null},enforceMaxBoundingRect(t){const e=this.getBoundingRect(t.ctx),i=-t.position.x/t.scale,n=(t.position.y,t.scale,t.canvas.width/t.scale);t.canvas.height,t.scale;if(e.x+e.width>i+n){const t=e.x-i;this.forcedWidth=n-t-10,this.renderer=null}},getBoundingRect(t,e){if(null==e&&(e=!1),!this.renderer){if(!t)throw"Must pass ctx if text hasn't been rendered yet";this._makeRenderer(t)}return{x:Math.floor(this.x),y:Math.floor(this.y),width:Math.ceil(this.renderer.getWidth(!0)),height:Math.ceil(this.renderer.getHeight())}},toJSON(){return{x:this.x,y:this.y,text:this.text,color:this.color,font:this.font,forcedWidth:this.forcedWidth,forcedHeight:this.forcedHeight,v:this.v}},fromJSON:t=>U("Text",t),move(t){null==t&&(t={}),this.x=this.x-t.xDiff,this.y=this.y-t.yDiff},setUpperLeft(t){null==t&&(t={}),this.x=t.x,this.y=t.y}}),F("SelectionBox",{constructor(t){null==t&&(t={}),this.shape=t.shape,null!=t.handleSize?this.handleSize=t.handleSize:this.handleSize=10,this.margin=4,this.backgroundColor=t.backgroundColor||null,this._br=this.shape.getBoundingRect(t.ctx)},toJSON(){return{shape:V(this.shape),backgroundColor:this.backgroundColor}},fromJSON:({shape:t,handleSize:e,margin:i,backgroundColor:n})=>U("SelectionBox",{shape:$(t),backgroundColor:n}),getTopLeftHandleRect(){return{x:this._br.x-this.handleSize-this.margin,y:this._br.y-this.handleSize-this.margin,width:this.handleSize,height:this.handleSize}},getBottomLeftHandleRect(){return{x:this._br.x-this.handleSize-this.margin,y:this._br.y+this._br.height+this.margin,width:this.handleSize,height:this.handleSize}},getTopRightHandleRect(){return{x:this._br.x+this._br.width+this.margin,y:this._br.y-this.handleSize-this.margin,width:this.handleSize,height:this.handleSize}},getBottomRightHandleRect(){return{x:this._br.x+this._br.width+this.margin,y:this._br.y+this._br.height+this.margin,width:this.handleSize,height:this.handleSize}},getBoundingRect(){return{x:this._br.x-this.margin,y:this._br.y-this.margin,width:this._br.width+2*this.margin,height:this._br.height+2*this.margin}}});class Z extends c{begin(t,e,i){return this.currentShape=U("Ellipse",{x:t,y:e,strokeWidth:this.strokeWidth,strokeColor:i.getColor("primary"),fillColor:i.getColor("secondary")})}continue(t,e,i){return this.currentShape.width=t-this.currentShape.x,this.currentShape.height=e-this.currentShape.y,i.drawShapeInProgress(this.currentShape)}end(t,e,i){return i.saveShape(this.currentShape)}}Z.prototype.name="Ellipse",Z.prototype.iconName="ellipse";var Q=Z;class tt extends c{begin(t,e,i){this.color=i.getColor("primary"),this.currentShape=this.makeShape(),this.currentShape.addPoint(this.makePoint(t,e,i)),this.lastEventTime=Date.now()}continue(t,e,i){const n=Date.now()-this.lastEventTime;n>this.eventTimeThreshold&&(this.lastEventTime+=n,this.currentShape.addPoint(this.makePoint(t,e,i)),i.drawShapeInProgress(this.currentShape))}end(t,e,i){i.saveShape(this.currentShape),this.currentShape=void 0}makePoint(t,e,i){return U("Point",{x:t,y:e,size:this.strokeWidth,color:this.color})}makeShape(){return U("LinePath")}}tt.prototype.name="Pencil",tt.prototype.iconName="pencil",tt.prototype.eventTimeThreshold=10;var et=tt;class it extends et{makePoint(t,e,i){return U("Point",{x:t,y:e,size:this.strokeWidth,color:"#000"})}makeShape(){return U("ErasedLinePath")}}it.prototype.name="Eraser",it.prototype.iconName="eraser";class nt extends c{begin(t,e,i){return this.currentShape=U("Line",{x1:t,y1:e,x2:t,y2:e,strokeWidth:this.strokeWidth,dash:function(){switch(!1){case!this.isDashed:return[2*this.strokeWidth,4*this.strokeWidth];default:return null}}.call(this),endCapShapes:this.hasEndArrow?[null,"arrow"]:null,color:i.getColor("primary")})}continue(t,e,i){return this.currentShape.x2=t,this.currentShape.y2=e,i.drawShapeInProgress(this.currentShape)}end(t,e,i){return i.saveShape(this.currentShape)}}nt.prototype.name="Line",nt.prototype.iconName="line",nt.prototype.optionsStyle="line-options-and-stroke-width";const st=function(t,e){var i,n,s;return n=e.x,s=e.y,(i=t.getImageData(n,s,1,1).data)[3]?"rgb("+i[0]+", "+i[1]+", "+i[2]+")":null};class rt extends l{readColor(t,e,i){var n,s,r;return r=i.getDefaultImageRect(),n=i.getImage(),(s=st(n.getContext("2d"),{x:t-r.x,y:e-r.y}))||i.getColor("background"),"stroke"===this.strokeOrFill?i.setColor("primary",s):i.setColor("secondary",s)}begin(t,e,i){return this.readColor(t,e,i)}continue(t,e,i){return this.readColor(t,e,i)}}rt.prototype.name="Eyedropper",rt.prototype.iconName="eyedropper",rt.prototype.optionsStyle="stroke-or-fill";class ot extends l{didBecomeActive(t){const e=[];return this.unsubscribe=function(){let t,i,n,s;for(s=[],i=0,n=e.length;i<n;i++)t=e[i],s.push(t());return s},e.push(t.on("lc-pointerdown",function(e){return function(i){let n,s;return n=i.rawX,s=i.rawY,e.oldPosition=t.position,e.pointerStart={x:n,y:s}}}(this))),e.push(t.on("lc-pointerdrag",function(e){return function(i){let n,s,r;return s=i.rawX,r=i.rawY,n={x:(s-e.pointerStart.x)*t.backingScale,y:(r-e.pointerStart.y)*t.backingScale},t.setPan(e.oldPosition.x+n.x,e.oldPosition.y+n.y)}}(this)))}willBecomeInactive(t){return this.unsubscribe()}}ot.prototype.name="Pan",ot.prototype.iconName="pan",ot.prototype.usesSimpleAPI=!1;class at extends c{begin(t,e,i){return this.currentShape=U("Rectangle",{x:t,y:e,strokeWidth:this.strokeWidth,strokeColor:i.getColor("primary"),fillColor:i.getColor("secondary")})}continue(t,e,i){return this.currentShape.width=t-this.currentShape.x,this.currentShape.height=e-this.currentShape.y,i.drawShapeInProgress(this.currentShape)}end(t,e,i){return i.saveShape(this.currentShape)}}at.prototype.name="Rectangle",at.prototype.iconName="rectangle";var ht=at;class lt extends l{constructor(){super(),this.selectCanvas=document.createElement("canvas"),this.selectCanvas.style["background-color"]="transparent",this.selectCtx=this.selectCanvas.getContext("2d")}didBecomeActive(t){var e,i,n,s;return s=[],this._selectShapeUnsubscribe=function(){var t,e,i,n;for(n=[],e=0,i=s.length;e<i;e++)t=s[e],n.push(t());return n},e=function(e){return function(i){var n,s,r,o;if(r=i.x,o=i.y,e.didDrag=!1,s=e._getPixel(r,o,t,e.selectCtx),e.selectedShape=t.shapes[s],null!=e.selectedShape)return t.trigger("shapeSelected",{selectedShape:e.selectedShape}),t.setShapesInProgress([e.selectedShape,U("SelectionBox",{shape:e.selectedShape,handleSize:0})]),t.repaintLayer("main"),n=e.selectedShape.getBoundingRect(),e.dragOffset={x:r-n.x,y:o-n.y}}}(this),i=function(e){return function(i){var n,s;if(n=i.x,s=i.y,null!=e.selectedShape)return e.didDrag=!0,e.selectedShape.setUpperLeft({x:n-e.dragOffset.x,y:s-e.dragOffset.y}),t.setShapesInProgress([e.selectedShape,U("SelectionBox",{shape:e.selectedShape,handleSize:0})]),t.repaintLayer("main")}}(this),n=function(e){return function(i){if(i.x,i.y,e.didDrag)return e.didDrag=!1,t.trigger("shapeMoved",{shape:e.selectedShape}),t.trigger("drawingChange",{}),t.repaintLayer("main"),e._drawSelectCanvas(t)}}(this),s.push(t.on("lc-pointerdown",e)),s.push(t.on("lc-pointerdrag",i)),s.push(t.on("lc-pointerup",n)),this._drawSelectCanvas(t)}willBecomeInactive(t){return this._selectShapeUnsubscribe(),t.setShapesInProgress([])}_drawSelectCanvas(t){var e;return this.selectCanvas.width=t.canvas.width,this.selectCanvas.height=t.canvas.height,this.selectCtx.clearRect(0,0,this.selectCanvas.width,this.selectCanvas.height),e=t.shapes.map(function(t){return function(e,i){return U("SelectionBox",{shape:e,handleSize:0,backgroundColor:"#"+t._intToHex(i)})}}(this)),t.draw(e,this.selectCtx)}_intToHex(t){return("000000"+t.toString(16)).slice(-6)}_getPixel(t,e,i,n){var s,r;return s=i.drawingCoordsToClientCoords(t,e),(r=n.getImageData(s.x,s.y,1,1).data)[3]?parseInt(this._rgbToHex(r[0],r[1],r[2]),16):null}_componentToHex(t){return("0"+t.toString(16)).slice(-2)}_rgbToHex(t,e,i){return""+this._componentToHex(t)+this._componentToHex(e)+this._componentToHex(i)}}lt.prototype.name="SelectShape",lt.prototype.usesSimpleAPI=!1;const ct=function(t,e){return!(t.x<e.x)&&(!(t.y<e.y)&&(!(t.x>e.x+e.width)&&!(t.y>e.y+e.height)))};class dt extends l{constructor(){super(),this.text="",this.font="bold 18px sans-serif",this.currentShape=null,this.currentShapeState=null,this.initialShapeBoundingRect=null,this.dragAction=null,this.didDrag=!1}didBecomeActive(t){var e,i,n;return i=[],this.unsubscribe=function(){var t,e,n,s;for(s=[],e=0,n=i.length;e<n;e++)t=i[e],s.push(t());return s},e=function(e){return function(){return e._ensureNotEditing(t),e._clearCurrentShape(t),t.repaintLayer("main")}}(this),n=function(e){return function(){return e._updateInputEl(t)}}(this),i.push(t.on("drawingChange",e)),i.push(t.on("zoom",n)),i.push(t.on("imageSizeChange",n)),i.push(t.on("snapshotLoad",function(e){return function(){return e._clearCurrentShape(t),t.repaintLayer("main")}}(this))),i.push(t.on("primaryColorChange",function(e){return function(i){if(e.currentShape)return e.currentShape.color=i,e._updateInputEl(t),t.repaintLayer("main")}}(this))),i.push(t.on("setFont",function(e){return function(i){if(e.currentShape)return e.font=i,e.currentShape.setFont(i),e._setShapesInProgress(t),e._updateInputEl(t),t.repaintLayer("main")}}(this)))}willBecomeInactive(t){return this.currentShape&&(this._ensureNotEditing(t),this.commit(t)),this.unsubscribe()}setText(t){return this.text=t}_ensureNotEditing(t){if("editing"===this.currentShapeState)return this._exitEditingState(t)}_clearCurrentShape(t){return this.currentShape=null,this.initialShapeBoundingRect=null,this.currentShapeState=null,t.setShapesInProgress([])}commit(t){return this.currentShape.text&&t.saveShape(this.currentShape),this._clearCurrentShape(t),t.repaintLayer("main")}_getSelectionShape(t,e){return null==e&&(e=null),U("SelectionBox",{shape:this.currentShape,ctx:t,backgroundColor:e})}_setShapesInProgress(t){switch(this.currentShapeState){case"selected":return t.setShapesInProgress([this._getSelectionShape(t.ctx),this.currentShape]);case"editing":return t.setShapesInProgress([this._getSelectionShape(t.ctx,"#fff")]);default:return t.setShapesInProgress([this.currentShape])}}begin(t,e,i){var n,s,r;if(this.dragAction="none",this.didDrag=!1,"selected"===this.currentShapeState||"editing"===this.currentShapeState?(n=this.currentShape.getBoundingRect(i.ctx),(r=this._getSelectionShape(i.ctx)).getBoundingRect(),ct(s={x:t,y:e},n)&&(this.dragAction="move"),ct(s,r.getBottomRightHandleRect())&&(this.dragAction="resizeBottomRight"),ct(s,r.getTopLeftHandleRect())&&(this.dragAction="resizeTopLeft"),ct(s,r.getBottomLeftHandleRect())&&(this.dragAction="resizeBottomLeft"),ct(s,r.getTopRightHandleRect())&&(this.dragAction="resizeTopRight"),"none"===this.dragAction&&"editing"===this.currentShapeState&&(this.dragAction="stop-editing",this._exitEditingState(i))):(this.color=i.getColor("primary"),this.currentShape=U("Text",{x:t,y:e,text:this.text,color:this.color,font:this.font,v:1}),this.dragAction="place",this.currentShapeState="selected"),"none"!==this.dragAction)return this.initialShapeBoundingRect=this.currentShape.getBoundingRect(i.ctx),this.dragOffset={x:t-this.initialShapeBoundingRect.x,y:e-this.initialShapeBoundingRect.y},this._setShapesInProgress(i),i.repaintLayer("main");this.commit(i)}continue(t,e,i){var n,s,r;if("none"!==this.dragAction){switch(r=(n=this.initialShapeBoundingRect).x+n.width,s=n.y+n.height,this.dragAction){case"place":this.currentShape.x=t,this.currentShape.y=e,this.didDrag=!0;break;case"move":this.currentShape.x=t-this.dragOffset.x,this.currentShape.y=e-this.dragOffset.y,this.didDrag=!0;break;case"resizeBottomRight":this.currentShape.setSize(t-(this.dragOffset.x-this.initialShapeBoundingRect.width)-n.x,e-(this.dragOffset.y-this.initialShapeBoundingRect.height)-n.y);break;case"resizeTopLeft":this.currentShape.setSize(r-t+this.dragOffset.x,s-e+this.dragOffset.y),this.currentShape.setPosition(t-this.dragOffset.x,e-this.dragOffset.y);break;case"resizeBottomLeft":this.currentShape.setSize(r-t+this.dragOffset.x,e-(this.dragOffset.y-this.initialShapeBoundingRect.height)-n.y),this.currentShape.setPosition(t-this.dragOffset.x,this.currentShape.y);break;case"resizeTopRight":this.currentShape.setSize(t-(this.dragOffset.x-this.initialShapeBoundingRect.width)-n.x,s-e+this.dragOffset.y),this.currentShape.setPosition(this.currentShape.x,e-this.dragOffset.y)}return this._setShapesInProgress(i),i.repaintLayer("main"),this._updateInputEl(i)}}end(t,e,i){if(this.currentShape)return this.currentShape.setSize(this.currentShape.forcedWidth,0),"selected"===this.currentShapeState&&("place"===this.dragAction||"move"===this.dragAction&&!this.didDrag)&&this._enterEditingState(i),this._setShapesInProgress(i),i.repaintLayer("main"),this._updateInputEl(i)}_enterEditingState(t){var e;if(this.currentShapeState="editing",this.inputEl)throw"State error";return this.inputEl=document.createElement("textarea"),this.inputEl.className="text-tool-input",this.inputEl.style.position="absolute",this.inputEl.style.transformOrigin="0px 0px",this.inputEl.style.backgroundColor="transparent",this.inputEl.style.border="none",this.inputEl.style.outline="none",this.inputEl.style.margin="0",this.inputEl.style.padding="4px",this.inputEl.style.zIndex="1000",this.inputEl.style.overflow="hidden",this.inputEl.style.resize="none",this.inputEl.value=this.currentShape.text,this.inputEl.addEventListener("mousedown",function(t){return t.stopPropagation()}),this.inputEl.addEventListener("touchstart",function(t){return t.stopPropagation()}),e=function(e){return function(i){return e.currentShape.setText(i.target.value),e.currentShape.enforceMaxBoundingRect(t),e._setShapesInProgress(t),t.repaintLayer("main"),e._updateInputEl(t),i.stopPropagation()}}(this),this.inputEl.addEventListener("keydown",function(e){return function(){return e._updateInputEl(t,!0)}}(this)),this.inputEl.addEventListener("keyup",e),this.inputEl.addEventListener("change",e),this._updateInputEl(t),t.containerEl.appendChild(this.inputEl),this.inputEl.focus(),this._setShapesInProgress(t)}_exitEditingState(t){return this.currentShapeState="selected",t.containerEl.removeChild(this.inputEl),this.inputEl=null,this._setShapesInProgress(t),t.repaintLayer("main")}_updateInputEl(t,e){var i,n;if(null==e&&(e=!1),this.inputEl)return i=this.currentShape.getBoundingRect(t.ctx,!0),this.inputEl.style.font=this.currentShape.font,this.inputEl.style.color=this.currentShape.color,this.inputEl.style.left=t.position.x/t.backingScale+i.x*t.scale-4+"px",this.inputEl.style.top=t.position.y/t.backingScale+i.y*t.scale-4+"px",e&&!this.currentShape.forcedWidth?this.inputEl.style.width=i.width+10+this.currentShape.renderer.emDashWidth+"px":this.inputEl.style.width=i.width+12+"px",this.inputEl.style.height=e?i.height+10+this.currentShape.renderer.metrics.leading+"px":i.height+10+"px",n="scale("+t.scale+")",this.inputEl.style.transform=n,this.inputEl.style.webkitTransform=n,this.inputEl.style.MozTransform=n,this.inputEl.style.msTransform=n,this.inputEl.style.OTransform=n}}dt.prototype.name="Text",dt.prototype.iconName="text",dt.prototype.optionsStyle="font";class ut extends c{constructor(t){super(t)}didBecomeActive(t){let e,i,n,s,r,o,a;return super.didBecomeActive.call(this,t),a=[],this.polygonUnsubscribe=function(){let t,e,i,n;for(n=[],e=0,i=a.length;e<i;e++)t=a[e],n.push(t());return n},this.points=null,this.maybePoint=null,n=function(e){return function(){return e._getWillFinish()?e._close(t):(t.trigger("lc-polygon-started"),e.points?e.points.push(e.maybePoint):e.points=[e.maybePoint],e.maybePoint={x:e.maybePoint.x,y:e.maybePoint.y},t.setShapesInProgress(e._getShapes(t)),t.repaintLayer("main"))}}(this),i=function(e){return function(i){var n,s;if(n=i.x,s=i.y,e.maybePoint)return e.maybePoint.x=n,e.maybePoint.y=s,t.setShapesInProgress(e._getShapes(t)),t.repaintLayer("main")}}(this),e=function(e){return function(i){var n,s;return n=i.x,s=i.y,e.maybePoint={x:n,y:s},t.setShapesInProgress(e._getShapes(t)),t.repaintLayer("main")}}(this),o=function(e){return function(){return e.maybePoint={x:1/0,y:1/0},e._close(t)}}(this),r=function(e){return function(){return e.maybePoint=e.points[0],e._close(t)}}(this),s=function(e){return function(){return e._cancel(t)}}(this),a.push(t.on("drawingChange",function(e){return function(){return e._cancel(t)}}(this))),a.push(t.on("lc-pointerdown",e)),a.push(t.on("lc-pointerdrag",i)),a.push(t.on("lc-pointermove",i)),a.push(t.on("lc-pointerup",n)),a.push(t.on("lc-polygon-finishopen",o)),a.push(t.on("lc-polygon-finishclosed",r)),a.push(t.on("lc-polygon-cancel",s))}willBecomeInactive(t){return super.willBecomeInactive.call(this,t),(this.points||this.maybePoint)&&this._cancel(t),this.polygonUnsubscribe()}_getArePointsClose(t,e){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)<10}_getWillClose(){return!!(this.points&&this.points.length>1)&&(!!this.maybePoint&&this._getArePointsClose(this.points[0],this.maybePoint))}_getWillFinish(){return!!(this.points&&this.points.length>1)&&(!!this.maybePoint&&(this._getArePointsClose(this.points[0],this.maybePoint)||this._getArePointsClose(this.points[this.points.length-1],this.maybePoint)))}_cancel(t){return t.trigger("lc-polygon-stopped"),this.maybePoint=null,this.points=null,t.setShapesInProgress([]),t.repaintLayer("main")}_close(t){return t.trigger("lc-polygon-stopped"),t.setShapesInProgress([]),this.points.length>2&&t.saveShape(this._getShape(t,!1)),this.maybePoint=null,this.points=null}_getShapes(t,e){var i;return null==e&&(e=!0),(i=this._getShape(t,e))?[i]:[]}_getShape(t,e){var i;return null==e&&(e=!0),i=[],this.points&&(i=i.concat(this.points)),!e&&i.length<3?null:(e&&this.maybePoint&&i.push(this.maybePoint),i.length>1?U("Polygon",{isClosed:this._getWillClose(),strokeColor:t.getColor("primary"),fillColor:t.getColor("secondary"),strokeWidth:this.strokeWidth,points:i.map(function(t){return U("Point",t)})}):null)}}ut.prototype.name="Polygon",ut.prototype.iconName="polygon",ut.prototype.usesSimpleAPI=!1,ut.prototype.optionsStyle="polygon-and-stroke-width";class pt{constructor(t,e,i){this.lc=t,this.oldShapes=e,this.newShapes=i}do(){this.lc.shapes=this.newShapes,this.lc.repaintLayer("main")}undo(){this.lc.shapes=this.oldShapes,this.lc.repaintLayer("main")}}class gt{constructor(t,e,i,n){this.lc=t,this.selectedShape=e,this.previousPosition=i,this.newPosition=n}do(){this.selectedShape.setUpperLeft({x:this.newPosition.x,y:this.newPosition.y}),this.lc.repaintLayer("main")}undo(){this.selectedShape.setUpperLeft({x:this.previousPosition.x,y:this.previousPosition.y}),this.lc.repaintLayer("main")}}class mt{constructor(t,e,i=null){this.lc=t,this.shape=e,this.previousShapeId=i}do(){if(this.lc.shapes.length&&this.lc.shapes[this.lc.shapes.length-1].id!==this.previousShapeId&&null!==this.previousShapeId){const t=[];let e=!1;for(let i of this.lc.shapes)t.push(i),i.id===this.previousShapeId&&(t.push(this.shape),e=!0);e||t.push(this.shape),this.lc.shapes=t}else this.lc.shapes.push(this.shape);this.lc.repaintLayer("main")}undo(){if(this.lc.shapes[this.lc.shapes.length-1].id===this.shape.id)this.lc.shapes.pop();else{const t=[];for(let e of this.lc.shapes)e.id!==this.shape.id&&t.push(e);this.lc.shapes=t}this.lc.repaintLayer("main")}}const ft=function(t,e){const i=e.changedTouches[0].clientX,n=e.changedTouches[0].clientY,s=t.getBoundingClientRect();return[i-s.left,n-s.top]},yt=function(t,e){const i=t.getBoundingClientRect();return{left:e.clientX-i.left,top:e.clientY-i.top}};var St=function(t,e,i){null==i&&(i=!1);const n=[],s=i=>{i.preventDefault();const n=yt(e,i);t.pointerMove(n.left,n.top)};var r=i=>{i.preventDefault(),e.onselectstart=(()=>!0);const n=yt(e,i);t.pointerUp(n.left,n.top),document.removeEventListener("mousemove",s),document.removeEventListener("mouseup",r),e.addEventListener("mousemove",s)};e.addEventListener("mousedown",i=>{if("canvas"!==i.target.tagName.toLowerCase())return;i.preventDefault(),e.onselectstart=(()=>!1);const n=yt(e,i);t.pointerDown(n.left,n.top),e.removeEventListener("mousemove",s),document.addEventListener("mousemove",s),document.addEventListener("mouseup",r)});const o=function(i){i.preventDefault(),t.pointerMove(...ft(e,i))};var a=function(i){i.preventDefault(),t.pointerUp(...ft(e,i)),document.removeEventListener("touchmove",o),document.removeEventListener("touchend",a),document.removeEventListener("touchcancel",a)};if(e.addEventListener("touchstart",function(i){"canvas"===i.target.tagName.toLowerCase()&&(i.preventDefault(),1===i.touches.length?(t.pointerDown(...ft(e,i)),document.addEventListener("touchmove",o),document.addEventListener("touchend",a),document.addEventListener("touchcancel",a)):t.pointerMove(...ft(e,i)))}),i){console.warn("Keyboard panning is deprecated.");const e=function(e){switch(e.keyCode){case 37:t.pan(-10,0);break;case 38:t.pan(0,-10);break;case 39:t.pan(10,0);break;case 40:t.pan(0,10)}t.repaintAllLayers()};document.addEventListener("keydown",e),n.push(()=>document.removeEventListener(e))}return()=>n.map(t=>t())};var xt={imageURLPrefix:"lib/img",primaryColor:"hsla(0, 0%, 0%, 1)",secondaryColor:"hsla(0, 0%, 100%, 1)",backgroundColor:"transparent",strokeWidths:[1,2,5,10,20,30],defaultStrokeWidth:5,toolbarPosition:"top",keyboardShortcuts:!1,imageSize:{width:"infinite",height:"infinite"},backgroundShapes:[],watermarkImage:null,watermarkScale:1,zoomMin:.2,zoomMax:4,zoomStep:.2,snapshot:null,onInit:()=>{},tools:[Q,ht],isCanDraw:!1};var wt=function(t,e){null==e&&(e={}),null==e.scale&&(e.scale=1);const i=t.shapes.map(t=>$(t));let n=t.backgroundShapes.map(t=>$(t));null==e.margin&&(e.margin={top:0,right:0,bottom:0,left:0});const s=t.imageSize||{width:"infinite",height:"infinite"},r=t.colors||{background:"transparent"},o=i.concat(n),a=document.createElement("canvas"),h=a.getContext("2d");return e.rect?(e.rect.x-=e.margin.left,e.rect.y-=e.margin.top,e.rect.width+=e.margin.left+e.margin.right,e.rect.height+=e.margin.top+e.margin.bottom):e.rect=W(o.map(t=>t.getBoundingRect(h)),s,e.margin),a.width=e.rect.width*e.scale,a.height=e.rect.height*e.scale,h.fillStyle=r.background,h.fillRect(0,0,a.width,a.height),e.rect.width&&e.rect.height?(e.watermarkImage&&function(t,e,i){e.width&&(t.save(),t.translate(t.canvas.width/2,t.canvas.height/2),t.scale(i,i),t.drawImage(e,-e.width/2,-e.height/2),t.restore())}(h,e.watermarkImage,e.watermarkScale),R(a,I(n,e.rect,e.scale),I(i,e.rect,e.scale))):null};var vt=function(t,e){null==e&&(e={});const i=t.shapes.map(t=>$(t)),n=t.backgroundShapes.map(t=>$(t));null==e.margin&&(e.margin={top:0,right:0,bottom:0,left:0});const s=t.imageSize||{width:"infinite",height:"infinite"},r=t.colors||{background:"transparent"},o=i.concat(n),a=document.createElement("canvas").getContext("2d");return e.rect?(e.rect.x-=e.margin.left,e.rect.y-=e.margin.top,e.rect.width+=e.margin.left+e.margin.right,e.rect.height+=e.margin.top+e.margin.bottom):e.rect=W(o.map(t=>t.getBoundingRect(a)),s,e.margin),n.concat(i),e.rect,void r.background};const bt="infinite";class kt{constructor(t,e){this.setImageSize=this.setImageSize.bind(this);let i=null,n=null;t instanceof HTMLElement?(n=t,i=e):i=t,i={...xt,...i},this.opts=i||{},this.config={zoomMin:i.zoomMin||.2,zoomMax:i.zoomMax||4,zoomStep:i.zoomStep||.2},this.colors={primary:i.primaryColor||"#000",secondary:i.secondaryColor||"#fff",background:i.backgroundColor||"transparent"},this.watermarkImage=i.watermarkImage,this.watermarkScale=i.watermarkScale||1,this.backgroundCanvas=document.createElement("canvas"),this.backgroundCtx=this.backgroundCanvas.getContext("2d"),this.canvas=document.createElement("canvas"),this.canvas.style["background-color"]="transparent",this.buffer=document.createElement("canvas"),this.buffer.style["background-color"]="transparent",this.ctx=this.canvas.getContext("2d"),this.bufferCtx=this.buffer.getContext("2d"),this.backingScale=M(this.ctx),this.backgroundShapes=i.backgroundShapes||[],this._shapesInProgress=[],this.shapes=[],this.undoStack=[],this.redoStack=[],this.isDragging=!1,this.position={x:0,y:0},this.scale=i.scale||1,this.setTool(new this.opts.tools[0](this)),this.width=i.imageSize.width||bt,this.height=i.imageSize.height||bt,this.setZoom(this.scale),i.snapshot&&this.loadSnapshot(i.snapshot),this.isBound=!1,n&&this.bindToElement(n),this.respondToSizeChange=function(){}}bindToElement(t){if(this.containerEl)return void console.warn("Trying to bind Literally Canvas to a DOM element more than once is unsupported.");this.containerEl=t,this.opts.isCanDraw&&(this._unsubscribeEvents=St(this,this.containerEl,this.opts.keyboardShortcuts)),this.containerEl.style["background-color"]=this.colors.background,this.containerEl.appendChild(this.backgroundCanvas),this.containerEl.appendChild(this.canvas),this.isBound=!0;const e=()=>{this.keepPanInImageBounds(),this.repaintAllLayers()};this.respondToSizeChange=E(this.containerEl,[this.backgroundCanvas,this.canvas],this.backingScale,e),this.watermarkImage&&(this.watermarkImage.onload=(()=>this.repaintLayer("background"))),null!=this.tool&&this.tool.didBecomeActive(this),e()}_teardown(){null!=this.tool&&this.tool.willBecomeInactive(this),"function"==typeof this._unsubscribeEvents&&this._unsubscribeEvents(),this.tool=null,this.containerEl=null,this.isBound=!1}teardown(){var t,e,i,n;for(e=0,i=(n=[...this.containerEl.children]).length;e<i;e++)t=n[e],this.containerEl.removeChild(t);this._teardown()}trigger(t,e){return this.canvas.dispatchEvent(new CustomEvent(t,{detail:e})),null}on(t,e){const i=t=>e(t.detail);return this.canvas.addEventListener(t,i),()=>{this.canvas.removeEventListener(t,i)}}getRenderScale(){return this.scale*this.backingScale}clientCoordsToDrawingCoords(t,e){return{x:(t*this.backingScale-this.position.x)/this.getRenderScale(),y:(e*this.backingScale-this.position.y)/this.getRenderScale()}}drawingCoordsToClientCoords(t,e){return{x:t*this.getRenderScale()+this.position.x,y:e*this.getRenderScale()+this.position.y}}setImageSize(t,e){this.width=t||bt,this.height=e||bt,this.keepPanInImageBounds(),this.repaintAllLayers(),this.trigger("imageSizeChange",{width:this.width,height:this.height})}setTool(t){this.isBound&&null!=this.tool&&this.tool.willBecomeInactive(this),this.tool=t,this.trigger("toolChange",{tool:t}),this.isBound&&this.tool.didBecomeActive(this)}setStrokeWidth(t){this.trigger("setStrokeWidth",t)}setPrimaryColor(t){this.setColor("primary",t)}setShapesInProgress(t){this._shapesInProgress=t}pointerDown(t,e){const i=this.clientCoordsToDrawingCoords(t,e);this.tool.usesSimpleAPI?(this.tool.begin(i.x,i.y,this),this.isDragging=!0,this.trigger("drawStart",{tool:this.tool})):(this.isDragging=!0,this.trigger("lc-pointerdown",{tool:this.tool,x:i.x,y:i.y,rawX:t,rawY:e}))}pointerMove(t,e){B(()=>{const i=this.clientCoordsToDrawingCoords(t,e);(null!=this.tool?this.tool.usesSimpleAPI:void 0)?this.isDragging&&(this.tool.continue(i.x,i.y,this),this.trigger("drawContinue",{tool:this.tool})):this.isDragging?this.trigger("lc-pointerdrag",{tool:this.tool,x:i.x,y:i.y,rawX:t,rawY:e}):this.trigger("lc-pointermove",{tool:this.tool,x:i.x,y:i.y,rawX:t,rawY:e})})}pointerUp(t,e){const i=this.clientCoordsToDrawingCoords(t,e);this.tool.usesSimpleAPI?this.isDragging&&(this.tool.end(i.x,i.y,this),this.isDragging=!1,this.trigger("drawEnd",{tool:this.tool})):(this.isDragging=!1,this.trigger("lc-pointerup",{tool:this.tool,x:i.x,y:i.y,rawX:t,rawY:e}))}setColor(t,e){if(this.colors[t]=e,this.isBound){switch(t){case"background":this.containerEl.style.backgroundColor=this.colors.background,this.repaintLayer("background");break;case"primary":case"secondary":this.repaintLayer("main")}this.trigger(`${t}ColorChange`,this.colors[t]),"background"===t&&this.trigger("drawingChange")}}getColor(t){return this.colors[t]}saveShape(t,e,i=null){null==e&&(e=!0),i||(i=this.shapes.length?this.shapes[this.shapes.length-1].id:null),this.execute(new mt(this,t,i)),e&&this.trigger("shapeSave",{shape:t,previousShapeId:i}),this.trigger("drawingChange")}pan(t,e){this.setPan(this.position.x-t,this.position.y-e)}keepPanInImageBounds(){const t=this.getRenderScale();let{x:e,y:i}=this.position;this.width!==bt&&(e=this.canvas.width>this.width*t?(this.canvas.width-this.width*t)/2:Math.max(Math.min(0,e),this.canvas.width-this.width*t)),this.height!==bt&&(i=this.canvas.height>this.height*t?(this.canvas.height-this.height*t)/2:Math.max(Math.min(0,i),this.canvas.height-this.height*t)),this.position={x:e,y:i}}setPan(t,e){this.position={x:t,y:e},this.keepPanInImageBounds(),this.repaintAllLayers(),this.trigger("pan",{x:this.position.x,y:this.position.y})}zoom(t){let e=this.scale+t;e=Math.max(e,this.config.zoomMin),e=Math.min(e,this.config.zoomMax),e=Math.round(100*e)/100,this.setZoom(e)}setZoom(t){const e=this.clientCoordsToDrawingCoords(this.canvas.width/2,this.canvas.height/2),i=this.scale;this.scale=t,this.position.x=this.canvas.width/2*this.backingScale-e.x*this.getRenderScale(),this.position.y=this.canvas.height/2*this.backingScale-e.y*this.getRenderScale(),this.keepPanInImageBounds(),this.repaintAllLayers(),this.trigger("zoom",{oldScale:i,newScale:this.scale})}setScale(...t){this.setZoom(...t)}setWatermarkImage(t){this.watermarkImage=t,C(t,()=>this.repaintLayer("background")),t.width&&this.repaintLayer("background")}repaintAllLayers(){for(let t of["background","main"])this.repaintLayer(t);return null}repaintLayer(t,e){if(null==e&&(e="main"===t),this.isBound){switch(t){case"background":this.backgroundCtx.clearRect(0,0,this.backgroundCanvas.width,this.backgroundCanvas.height);var i=()=>this.repaintLayer("background");this.watermarkImage&&this._renderWatermark(this.backgroundCtx,!0,i),this.draw(this.backgroundShapes,this.backgroundCtx,i);break;case"main":i=(()=>this.repaintLayer("main",!0)),e&&(this.buffer.width=this.canvas.width,this.buffer.height=this.canvas.height,this.bufferCtx.clearRect(0,0,this.buffer.width,this.buffer.height),this.draw(this.shapes,this.bufferCtx,i)),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.canvas.width>0&&this.canvas.height>0&&(this.ctx.fillStyle="#ccc",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.clipped(()=>{this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.drawImage(this.buffer,0,0)},this.ctx),this.clipped(()=>{this.transformed(()=>{this._shapesInProgress.map(t=>f(this.ctx,t,{bufferCtx:this.bufferCtx,shouldOnlyDrawLatest:!0}))},this.ctx,this.bufferCtx)},this.ctx,this.bufferCtx))}this.trigger("repaint",{layerKey:t})}}_renderWatermark(t,e,i){null==e&&(e=!0),this.watermarkImage.width?(t.save(),t.translate(t.canvas.width/2,t.canvas.height/2),t.scale(this.watermarkScale,this.watermarkScale),e&&t.scale(this.backingScale,this.backingScale),t.drawImage(this.watermarkImage,-this.watermarkImage.width/2,-this.watermarkImage.height/2),t.restore()):this.watermarkImage.onload=i}drawShapeInProgress(t){this.repaintLayer("main",!1),this.clipped(()=>{this.transformed(()=>{f(this.ctx,t,{bufferCtx:this.bufferCtx,shouldOnlyDrawLatest:!0})},this.ctx,this.bufferCtx)},this.ctx,this.bufferCtx)}draw(t,e,i){if(!t.length)return;const n=()=>{t.map(t=>f(e,t,{retryCallback:i}))};this.clipped(()=>this.transformed(n,e),e)}clipped(t,...e){const i=this.width===bt?0:this.position.x,n=this.height===bt?0:this.position.y,s=this.width===bt?this.canvas.width:this.width*this.getRenderScale(),r=this.height===bt?this.canvas.height:this.height*this.getRenderScale();for(var o of e)o.save(),o.beginPath(),o.rect(i,n,s,r),o.clip();for(o of(t(),e))o.restore()}transformed(t,...e){for(var i of e){i.save(),i.translate(Math.floor(this.position.x),Math.floor(this.position.y));const t=this.getRenderScale();i.scale(t,t)}for(i of(t(),e))i.restore()}clear(t){null==t&&(t=!0);const e=this.shapes;this.setShapesInProgress([]),this.execute(new pt(this,e,[])),this.repaintLayer("main"),t&&this.trigger("clear",null),this.trigger("drawingChange",{})}execute(t){this.undoStack.push(t),t.do(),this.redoStack=[]}undo(t){if(null==t&&(t=!0),!this.undoStack.length)return;const e=this.undoStack.pop();e.undo(),this.redoStack.push(e),t&&this.trigger("undo",{action:e}),this.trigger("drawingChange",{})}redo(t){if(null==t&&(t=!0),!this.redoStack.length)return;const e=this.redoStack.pop();this.undoStack.push(e),e.do(),t&&this.trigger("redo",{action:e}),this.trigger("drawingChange",{})}canUndo(){return!!this.undoStack.length}canRedo(){return!!this.redoStack.length}getPixel(t,e){const i=this.drawingCoordsToClientCoords(t,e),n=this.ctx.getImageData(i.x,i.y,1,1).data;return n[3]?`rgb(${n[0]}, ${n[1]}, ${n[2]})`:null}getContentBounds(){return _(this.shapes.concat(this.backgroundShapes).map(t=>t.getBoundingRect()),this.width===bt?0:this.width,this.height===bt?0:this.height)}getDefaultImageRect(t,e){return null==t&&(t={width:0,height:0}),null==e&&(e={top:0,right:0,bottom:0,left:0}),W(this.shapes.concat(this.backgroundShapes).map(t=>t.getBoundingRect(this.ctx)),t,e)}getImage(t){return null==t&&(t={}),null==t.includeWatermark&&(t.includeWatermark=!0),null==t.scaleDownRetina&&(t.scaleDownRetina=!0),null==t.scale&&(t.scale=1),t.scaleDownRetina||(t.scale*=this.backingScale),t.includeWatermark&&(t.watermarkImage=this.watermarkImage,t.watermarkScale=this.watermarkScale,t.scaleDownRetina||(t.watermarkScale*=this.backingScale)),wt(this.getSnapshot(),t)}canvasForExport(){return this.repaintAllLayers(),R(this.backgroundCanvas,this.canvas)}canvasWithBackground(t){return R(t,this.canvasForExport())}getSnapshot(t=null){null==t&&(t=["shapes","imageSize","colors","position","scale","backgroundShapes"]);const e={};for(let i of["colors","position","scale"])t.indexOf(i)>=0&&(e[i]=this[i]);return t.indexOf("shapes")>=0&&(e.shapes=this.shapes.map(t=>V(t))),t.indexOf("backgroundShapes")>=0&&(e.backgroundShapes=this.backgroundShapes.map(t=>V(t))),t.indexOf("imageSize")>=0&&(e.imageSize={width:this.width,height:this.height}),e}getSnapshotJSON(){return console.warn("lc.getSnapshotJSON() is deprecated. use JSON.stringify(lc.getSnapshot()) instead."),JSON.stringify(this.getSnapshot())}getSVGString(t){return null==t&&(t={}),vt(this.getSnapshot(),t)}loadSnapshot(t){if(t){if(t.colors)for(let e of["primary","secondary","background"])this.setColor(e,t.colors[e]);if(t.shapes){this.shapes=[],this.undostack=[];for(let e of t.shapes){const t=$(e);t&&this.execute(new mt(this,t))}}t.backgroundShapes&&(this.backgroundShapes=t.backgroundShapes.map(t=>$(t))),t.imageSize&&(this.width=t.imageSize.width,this.height=t.imageSize.height),t.position&&(this.position=t.position),t.scale&&(this.scale=t.scale),this.repaintAllLayers(),this.trigger("snapshotLoad"),this.trigger("drawingChange",{})}}loadSnapshotJSON(t){console.warn("lc.loadSnapshotJSON() is deprecated. use lc.loadSnapshot(JSON.parse(snapshot)) instead."),this.loadSnapshot(JSON.parse(t))}}kt.defaultOptions=xt;var Ct=kt;let Pt={};const zt=t=>Pt=t,Et=function(t){return Pt[t]||t},Rt={toPoly:function(t){let e=[],i=[],n=0;for(let s of t){const r=Lt(s,It(t,n));e=e.concat([r[0]]),i=[r[1]].concat(i),n+=1}return e.concat(i)}};var It=function(t,e){let i;return t.length<3&&(i={x:0,y:0}),i=0===e?It(t,e+1):e===t.length-1?It(t,e-1):Rt.diff(t[e-1],t[e+1])};Rt.diff=((t,e)=>({x:e.x-t.x,y:e.y-t.y}));var Lt=function(t,e){return(e=function(t){const e=Rt.len(t);return{x:t.x/e,y:t.y/e}}(e)).x=e.x*t.size/2,e.y=e.y*t.size/2,[{x:t.x-e.y,y:t.y+e.x,color:t.color},{x:t.x+e.y,y:t.y-e.x,color:t.color}]};Rt.len=(t=>Math.sqrt(Math.pow(t.x,2)+Math.pow(t.y,2))),Rt.scalePositionScalar=function(t,e,i,n){return t+(e*i-e*n)/2};var _t=Rt;i.d(e,"actions",function(){return a}),i.d(e,"bindEvents",function(){return St}),i.d(e,"canvasRenderer",function(){return n}),i.d(e,"defaultOptions",function(){return xt}),i.d(e,"lineEndCapShapes",function(){return u}),i.d(e,"TKCanvas",function(){return Ct}),i.d(e,"localization",function(){return h}),i.d(e,"math",function(){return _t}),i.d(e,"renderSnapshotToImage",function(){return wt}),i.d(e,"renderSnapshotToSVG",function(){return vt}),i.d(e,"shapes",function(){return o}),i.d(e,"svgRenderer",function(){return s}),i.d(e,"TextRenderer",function(){return H}),i.d(e,"util",function(){return r}),i.d(e,"Ellipse",function(){return Q}),i.d(e,"Rectangle",function(){return ht}),window&&(window.TKWB={actions:a,bindEvents:St,canvasRenderer:n,defaultOptions:xt,lineEndCapShapes:u,TKCanvas:Ct,localization:h,math:_t,renderSnapshotToImage:wt,renderSnapshotToSVG:vt,shapes:o,svgRenderer:s,TextRenderer:H,util:r,Ellipse:Q,Rectangle:ht});e.default=Ct}]);